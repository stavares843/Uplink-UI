name: Update PRs on Dev Branch Changes

on:
  push:
    branches:
      - dev

jobs:
  update_prs:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Update PRs
        run: |
          git fetch origin dev
          git checkout dev
          git pull origin dev

          # Find open pull requests targeting the dev branch
          PR_LIST=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              https://api.github.com/repos/${{ github.repository }}/pulls\?state\=open\&head\=${{ github.repository }}:dev | jq -r '.[].number')

          # Update each open pull request
          for PR_NUMBER in $PR_LIST; do
            curl -X PATCH -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/${{ github.repository }}/pulls/$PR_NUMBER/update-branch
          done
